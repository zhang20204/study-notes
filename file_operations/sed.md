---
title: sed
toc: true
---
[toc]

# sed 作用  
    1. sed 是一种流编辑器，它一次处理一行内容;
    2. 处理时，把当前处理的行存储在临时缓冲区中，称为“模式空间”（patternspace ），接着用sed 命令处理缓冲区中的内容，处理完成后，把缓冲区的内容送往屏幕。然后读入下行，执行下一个循环;
    3. 如果没有使诸如‘D’ 的特殊命令，那会在两个循环之间清空模式空间，但不会清空保留空间。这样不断重复，直到文件末尾;
    4. 文件内容并没有改变，除非使用重定向存储输出或-i。

# 语法
```shell
sed [options] '[地址界定] command' file(s)
```
* 参数说明：
    * -n：不输出模式空间内容到屏幕，即不自动打印，只打印匹配到的行
    * -e：多点编辑，对每行处理时，可以有多个Script
    * -f：把Script写到文件当中，在执行sed时-f 指定文件路径，如果是多个Script，换行写
    * -r：支持扩展的正则表达式
    * -i：直接将处理的结果写入文件
    * -i.bak：在将处理的结果写入文件之前备份一份

* 地址界定
    * 不给地址：对全文进行处理
    * 单地址：
        * #: 指定的行
        * /pattern/：被此处模式所能够匹配到的每一行
    * 地址范围：
        * #,#
        * #,+#
        * /pat1/,/pat2/
        * #,/pat1/
    * ~：步进
        * sed -n '1~2p'  只打印奇数行 （1~2 从第1行，一次加2行）
        * sed -n '2~2p'  只打印偶数行

* command：
    * d：删除模式空间匹配的行，并立即启用下一轮循环
    * p：打印当前模式空间内容，追加到默认输出之后
    * a：在指定行后面追加文本，支持使用\n实现多行追加
    * i：在行前面插入文本，支持使用\n实现多行追加
    * c：替换行为单行或多行文本，支持使用\n实现多行追加
    * w：保存模式匹配的行至指定文件
    * r：读取指定文件的文本至模式空间中匹配到的行后
    * =：为模式空间中的行打印行号
    * !：模式空间中匹配行取反处理
    * s///：查找替换，支持使用其它分隔符，如：s@@@，s###；
        * 加g表示行内全局替换；
        * 在替换时，可以加一下命令，实现大小写转换
        * \l：把下个字符转换成小写。
        * \L：把replacement字母转换成小写，直到\U或\E出现。
        * \u：把下个字符转换成大写。
        * \U：把replacement字母转换成大写，直到\L或\E出现。
        * \E：停止以\L或\U开始的大小写转换

# 常用需求
修改指定目录下所有文件中匹配到内容：
```shell
grep -rl "pattern" dirname | xargs sed -i "s/string_before/string_affter/g"
```
