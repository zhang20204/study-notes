[toc]

---
# 宏  
* make 允许使用类似变量的宏，格式为：
    ```make
    macros_name = value
    ```
* 示例
    ```make
    MACROS  = -me
    PSROFF  = groff -Tps
    DITROFF = groff -Tdvi
    CFLAGS  = -O -systype bsd43
    LIBS    = "-lncurses -lm -lsdl"
    MYFACE  = ":*)"
    ```
---
# 特殊宏
* `$@`
    表示规则的目标文件名。如果目标是一个文档文件（Linux中，一般称.a文件为文档文件，也称为静态库文件），那么它代表这个文档的文件名。在多目标模式规则中，它代表的是哪个触发规则被执行的目标文件名。
* `$%`
    当规则的目标文件是一个静态库文件时，代表静态库的一个成员名。例如，规则的目标是“foo.a(bar.o)”，那么，“$%”的值就为“bar.o”，“$@”的值为“foo.a”。如果目标不是静态库文件，其值为空
* `$<`
    规则的第一个依赖文件名。如果是一个目标文件使用隐含规则来重建，则它代表由隐含规则加入的第一个依赖文件。
* `$?`
    所有比目标文件更新的依赖文件列表，空格分割。如果目标是静态库文件名，代表的是库成员（.o文件）。
* `$^`
    规则的所有依赖文件列表，使用空格分隔。如果目标是静态库文件，它所代表的只能是所有库成员（.o文件）名。一个文件可重复的出现在目标的依赖中，变量“$^”只记录它的一次引用情况。就是说变量“$^”会去掉重复的依赖文件。
* `$+`
    类似“$^”，但是它保留了依赖文件中重复出现的文件。主要用在程序链接时库的交叉引用场合。
* `$*`
    在 模式规则和静态模式规则中，代表“茎”。“茎”是目标模式中“%”所代表的部分（当文件名中存在目录时，“茎”也包含目录（斜杠之前）部分）。例如：文件 “dir/a.foo.b”，当目标的模式为“a.%.b”时，“$*”的值为“dir/a.foo”。“茎”对于构造相关文件名非常有用。

---
# 约定俗成的目标
    all: 编译所有
    install: 安装
    clean: 清理
    .PHONY: 伪目标
        .PHONY作用：可以避免目标与文件名的冲突;在执行伪目标时，操作必然执行。
# 依赖相关
## 文件名的处理方法
1. 使用shell获取文件名
```make
SOURCE_FILES = $(shell find ./source_dir -type f -name '*.c')
```
2. 替换文件后缀
```make
OBJECTS = $(SOURCE_FILES:.cpp=.o)
```
## 产生依赖的模式规则
1. 将`.c`文件转换为`.o`文件
```make
.c.o:
    $(AS) -c $< -o $*.o
```
